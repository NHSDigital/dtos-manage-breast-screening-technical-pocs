{% extends "layout.html" %}
{% from 'components/molecules/table/macro.html' import table %}

{% block content %}
  <h1>Clinic appointments</h1>

  {{ table(headers, rows) }}
{% endblock %}

{% block extra_scripts %}
<script>
  // Poll for appointment status updates every 3 seconds
  const clinicId = "{{ clinic.id }}";
  const pollInterval = 3000; // 3 seconds

  function updateStatuses() {
    fetch(`/api/clinic/${clinicId}/statuses`)
      .then(response => response.json())
      .then(statuses => {
        // Update each appointment status
        Object.entries(statuses).forEach(([appointmentId, data]) => {
          const statusElement = document.querySelector(`[data-appointment-id="${appointmentId}"]`);
          if (statusElement && statusElement.innerHTML !== data.html) {
            // Add a brief highlight animation when status changes
            statusElement.innerHTML = data.html;
            statusElement.classList.add('status-updated');
            setTimeout(() => statusElement.classList.remove('status-updated'), 1000);
          }
        });
      })
      .catch(error => {
        console.error('Error fetching appointment statuses:', error);
      });
  }

  // Start polling when page loads
  setInterval(updateStatuses, pollInterval);
</script>

<style>
  .status-updated {
    animation: highlight 1s ease-in-out;
  }

  @keyframes highlight {
    0%, 100% { background-color: transparent; }
    50% { background-color: #ffe16f; }
  }
</style>
{% endblock %}
