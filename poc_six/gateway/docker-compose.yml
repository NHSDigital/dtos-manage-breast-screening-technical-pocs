services:
  orthanc-mwl:
    build:
      context: .
      dockerfile: Dockerfile
    container_name: orthanc-mwl-gateway
    ports:
      # Orthanc Web UI and REST API
      - "8042:8042"
      # Orthanc main DICOM port
      - "4242:4242"
      # Modality Worklist / MPPS DICOM port
      - "4243:4243"
    volumes:
      # Mount the scripts directory for easier development
      - ./scripts:/scripts
      # Mount the config for easier modification
      - ./orthanc.json:/etc/orthanc/orthanc.json
      # Persist Orthanc database
      - orthanc-db:/var/lib/orthanc/db
      # Shared worklist database
      - worklist-db:/var/lib/orthanc/worklist
      # Persist logs
      - orthanc-logs:/var/log/orthanc
    env_file:
      - .env
    environment:
      - ORTHANC_CONFIG=/etc/orthanc/orthanc.json
      - WORKLIST_DB_PATH=/var/lib/orthanc/worklist/worklist.db
    restart: unless-stopped
    networks:
      - mwl-network

  relay-listener:
    build:
      context: .
      dockerfile: Dockerfile
    container_name: relay-listener
    entrypoint: python3
    command: /scripts/relay_listener.py
    volumes:
      # Mount the scripts directory for easier development
      - ./scripts:/scripts
      # Shared worklist database
      - worklist-db:/var/lib/orthanc/worklist
    env_file:
      - .env
    environment:
      - PYTHONUNBUFFERED=1
      - WORKLIST_DB_PATH=/var/lib/orthanc/worklist/worklist.db
    restart: unless-stopped
    networks:
      - mwl-network
    depends_on:
      - orthanc-mwl

volumes:
  orthanc-db:
    driver: local
  orthanc-logs:
    driver: local
  worklist-db:
    driver: local

networks:
  mwl-network:
    driver: bridge
